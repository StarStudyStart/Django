<html>
<head>
  <title>2016-08-05</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="723"/>
<h1>2016-08-05</h1>

<div>
<span><div><span style="color: rgb(229, 0, 255);">今日总结：</span></div><div><span style="color: rgb(229, 0, 255);">1、选择图片时对返回的uri进行处理，得到该图片的真实uri和id，通过</span><b>getContentReslocer().query()</b><span style="color: rgb(229, 0, 255);">,进而取得该图片的真实地址，4.4版本以后，android 的API对返回的uri进行了封装，所以要取得真实的uri需要一层层的解封;</span></div><div><span style="color: rgb(229, 0, 255);">     （1） 通过</span> <b>intent.getData()</b> <span style="color: rgb(229, 0, 255);">取得封装后的Uri；</span></div><div><span style="color: rgb(229, 0, 255);">     （2）判断该uri是否为Documents类型 ，如果是的话则进一步判断该uri.的权限是否是meidia格式的或者downloads格式的；如果不是doc类型，进一步判断格式是否是“content：//”类型的</span></div><div><span style="color: rgb(229, 0, 255);">                                   <br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.148438);"><div><span style="font-size: 15px;">//        判断是否为document类型的id</span></div><div><span style="font-size: 15px;">      if (DocumentsContract .isDocumentUri( this, uri)) {</span></div><div><span style="font-size: 15px;">          String docId = DocumentsContract. getDocumentId(uri);     // <span style="color: rgb(235, 0, 115);">？</span></span></div><div><span style="font-size: 15px;">           if (&quot;com.android.providers.media.documents&quot; .equals(uri.getAuthority())) {</span></div><div><span style="font-size: 15px;">//                  權限是 meida格式，首先取出id，再通過media格式的 uri，附加搜索條件</span></div><div><span style="font-size: 15px;">                    String id = docId.split( &quot;:&quot;)[1];             //    <span style="color: rgb(235, 0, 115);">？</span></span></div><div><span style="font-size: 15px;">                    String selection = MediaStore.Images.Media._ID + &quot;=&quot; +id;</span></div><div><span style="font-size: 15px;">                    imagePath = getImagePath(MediaStore.Images.Media.EXTERNAL_CONTENT_URI , selection);</span></div><div><span style="font-size: 15px;">               } else if (&quot;com.android.providers.downloads.documents&quot; .equals(uri.getAuthority())) {</span></div><div><span style="font-size: 15px;">//                  權限是downloads格式，直接將id附加在指定的 uri之後</span></div><div><span style="font-size: 15px;">                    Uri contentUri = ContentUris.withAppendedId(Uri. parse(&quot;content://downloads/public_downloads&quot; ), Long.valueOf(docId));</span></div><div><span style="font-size: 15px;">                    imagePath = getImagePath(contentUri, null );</span></div><div><span style="font-size: 15px;">               }</span></div><div><br/></div><div><span style="font-size: 15px;">          } else if (&quot;content&quot; .equalsIgnoreCase(uri.getScheme())){</span></div><div><span style="font-size: 15px;">               imagePath = getImagePath(uri, null);</span></div><div><span style="font-size: 15px;">          }</span></div><div><span style="font-size: 12px;">          </span></div><div><span style="font-size: 12px;"><br/></span></div></div><div><span style="color: rgb(229, 0, 255);">          （3） 通过以上不同的情况获取的uri，获取真实地址；</span></div><div><span style="color: rgb(229, 0, 255);"><br/></span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>//    获取选中的图片的路径</div><div>    private String getImagePath(Uri uri,String selection){</div><div>     String imagePath = null;</div><div>     Cursor cursor = getContentResolver().query(uri, null, selection, null , null );</div><div>      if (cursor != null) {</div><div>                if ( cursor.moveToFirst()) {</div><div>                    imagePath = cursor.getString(cursor.getColumnIndex(Media.DATA ));</div><div>               }</div><div>          }</div><div>           return imagePath;</div><div>    }</div></div><div><span style="color: rgb(229, 0, 255);">          （4） 在控件中显示出来，首先要获取bitmap对象</span> <b>BitmapFactory.decodeFile(path);</b></div><div><span style="color: rgb(229, 0, 255);"><br/></span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>//    显示选中的图片</div><div>    private void disPlayImage(String path){</div><div>     Bitmap bitmap = BitmapFactory.decodeFile(path);</div><div>      picture.setImageBitmap(bitmap);</div><div>    }</div></div><div><span style="color: rgb(229, 0, 255);"><br/></span></div><div><span style="color: rgb(229, 0, 255);"> 2、 多媒体文件的播放（音频、视频）</span></div><div><span style="color: rgb(229, 0, 255);">          播放音乐  可以使用MediaPlayer对象<br/></span></div><div><span style="color: rgb(229, 0, 255);">          VideoView可以作为控件使用，但是一样可以设置播放路径、实现播放、暂停的功能；</span></div><div><span style="color: rgb(229, 0, 255);"><br/></span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>video .setVideoPath(file.getPath());</div></div><div><span style="color: rgb(229, 0, 255);"><br/></span></div><div><span style="color: rgb(229, 0, 255);"><br/></span></div><div><b><span style="color: rgb(227, 0, 0);">今日问题遗留：</span></b></div><div><b><span style="color: rgb(227, 0, 0);">        </span></b> <span style="font-size: 15px;">Document类型的Uri，如何获取</span><span style="font-size: 15px;">Document</span> 类型uri的id<span style="font-size: 15px;">？？</span></div><div>          git的使用第二部分</div></span>
</div></body></html> 