<html>
<head>
  <title>Viewpager之notifyDataSetChanged无刷新</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="893"/>
<h1>Viewpager之notifyDataSetChanged无刷新</h1>

<div>
<span><div style="-evernote-webclip:true"><br/></div><div style="background:white;color:rgb(51, 51, 51);font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:13px;font-family:&quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><div style="overflow:hidden;background:white;border:1px solid rgb(222, 222, 222);background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:690px;height:5138px;"><h2 style="font-weight:bold;border:;padding:0px;font-size:15px;margin-left:15px;margin-right:15px;margin:0px;border-bottom:1px solid rgb(222, 222, 222);text-shadow:rgb(255, 255, 255) 0px 1px 1px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:660px;">追溯源码解决android疑难问题1–Viewpager之notifyDataSetChanged无刷新</h2><div style="color:rgb(119, 119, 119);border:0px none rgb(119, 119, 119);padding:0px;font-size:12px;padding-left:14px;margin:0px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:676px;height:22px;">作者：望月听涛   发布：2013-09-14 10:04   分类：<a href="http://www.67tgb.com/?cat=141" rel="category" style="border:0px none rgb(98, 98, 98);margin:0px;padding:0px;color:rgb(98, 98, 98);text-decoration:none;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" title="查看 Android 的全部文章">Android</a>   阅读：16,735次   <a href="http://www.67tgb.com/?p=624#comments" style="border:0px none rgb(98, 98, 98);margin:0px;padding:0px;color:rgb(98, 98, 98);text-decoration:none;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" title="追溯源码解决android疑难问题1–Viewpager之notifyDataSetChanged无刷新 上的评论">1条评论</a>  </div><div style="border:0px none rgb(51, 51, 51);padding:0px 10px;overflow:hidden;font-size:14px;margin:0px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:5091px;"><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:56px;">  最近项目结束，搞了一次代码分享。其中一位同学分享了一下自己在解决问题过程中的一些心得体会，感觉受益匪浅。整理出来，分享给大家。</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:84px;">  建议使用自己编译的android os和虚拟机，这样就可以调试android系统中的任何组件。简单说来，深入android源码，去寻找解决问题的答案。这事儿说起来简单，实际做起来还是有些难度的。我也曾经尝试着去看过，没看一会儿就晕了。</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:28px;">  所以还是有针对性的去看源码，效率会高一些。</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:28px;">  废话不多说，先看第一个示例。 </p><h3 style="border:0px none rgb(51, 51, 51);margin:0px;padding:0px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;">Viewpager在调用notifyDataSetChanged()时，界面无刷新。</h3><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:56px;">  相信很多做过Viewpager的同学肯定遇到过这个问题，这个是bug还是android就是如此设计的，我们不做讨论。总之，它确实影响我们功能的实现了。</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:56px;">  可能不少同学选择为Viewpager重新设置一遍适配器adapter，达到刷新的目的。但是这种方法在大多数情况下，是有问题的。</p><h3 style="border:0px none rgb(51, 51, 51);margin:0px;padding:0px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;">追踪源代码：</h3><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:28px;">  为什么调用数据更新的方法，Viewpager却没有更新呢，我们跟进该方法的源代码看一下。</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:56px;">  首先查看适配器调用的super.notifyDataSetChanged()，该方法调到抽象基类PagerAdapter.notifyDataSetChanged()中：</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:28px;"> </p><div style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0px;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:196px;"><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
    <span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">/**</span></pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;"><span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">     * This method should be called by the application if the data backing this adapter has changed</span></pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;"><span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">     * and associated views should update.</span></pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;"><span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">     */</span></pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
    <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">public</span> <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">void</span> notifyDataSetChanged() {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
        mObservable.notifyChanged();
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
    }
</pre></div><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:28px;"> </p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:56px;">注释里说到，当附加在适配器上的数据发生变化时，应该调用该方法刷新数据。该方法调用了一个mObservable .notifyChanged()；</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:28px;">  我们继续跟进这个方法，进入DataSetObservable类中，发现这样一段代码：</p><div style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0px;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:476px;"><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
  <span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">/**</span></pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;"><span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">     * Invokes {@link DataSetObserver#onChanged} on each observer.</span></pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;"><span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">     * Called when the contents of the data set have changed.  The recipient</span></pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;"><span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">     * will obtain the new contents the next time it queries the data set.</span></pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;"><span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">     */</span></pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
    <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">public</span> <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">void</span> notifyChanged() {
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
        synchronized(mObservers ) {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
            <span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">// since onChanged() is implemented by the app, it could do anything, including</span></pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            <span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">// removing itself from {@link mObservers} - and that could cause problems if</span></pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
            <span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">// an iterator is used on the ArrayList {@link mObservers}.</span></pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            <span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">// to avoid such problems, just march thru the list in the reverse order.</span></pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
            <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">for</span> (<span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">int</span> i = mObservers .size() - 1; i &gt;= 0; i--) {
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                mObservers.get(i).onChanged();
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
            }
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
        }
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
    }
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
 
</pre></div><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:84px;">   这都不是重点，重点我们来看这个mObservers的类型是一个抽象类DataSetObserver，里面只有两个未实现的方法，都有谁使用了这个抽象类呢，快捷键 ctrl + alt + H ,在众多的调用者当中，我们发现了Viewpager的身影</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:276px;"><img src="Viewpager之notifyDataSetChanged无刷新_files/YHcfd.png" type="image/png" data-filename="YHcfd.png" height="276" style="border: 0px none rgb(51, 51, 51); padding: 0px; display: block; float: none; margin: 0px auto; background-color: rgba(0, 0, 0, 0); background-image: none; box-shadow: none; width: 543px; height: auto;" width="543"/></p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:56px;">    进入viewpager，我们终于找到了viewpager中控制数据变更的重点方法dataSetChanged ，这个方法如下：</p><div style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0px;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:1932px;"><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
      <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">void</span> dataSetChanged () {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
        <span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">// This method only gets called if our observer is attached, so mAdapter is non-null.</span></pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
 
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
        boolean needPopulate = mItems .size() &lt; mOffscreenPageLimit * 2 + 1 &amp;&amp;
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                mItems.size() &lt; mAdapter.getCount();
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
        <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">int</span> newCurrItem = mCurItem ;
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
 
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
        boolean isUpdating = <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">false</span>;
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
        <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">for</span> (<span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">int</span> i = 0; i &lt; mItems.size(); i++) {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
            final ItemInfo ii = mItems .get(i);
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            final <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">int</span> newPos = mAdapter.getItemPosition(ii.<span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">object</span> );
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
 
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">if</span> (newPos == PagerAdapter.POSITION_UNCHANGED ) {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">continue</span>;
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            }
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
 
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">if</span> (newPos == PagerAdapter.POSITION_NONE) {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                mItems.remove(i);
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                i--;
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
 
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">if</span> (!isUpdating) {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                    mAdapter.startUpdate( <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">this</span>);
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                    isUpdating = <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">true</span>;
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                }
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
 
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                mAdapter.destroyItem( <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">this</span>, ii.position , ii.<span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">object</span>);
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                needPopulate = <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">true</span>;
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
 
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">if</span> (mCurItem == ii.position ) {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                    <span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">// Keep the current item in the valid range</span></pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                    newCurrItem = Math. max(0, Math.min(mCurItem, mAdapter.getCount() - 1));
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                    needPopulate = <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">true</span>;
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                }
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">continue</span>;
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            }
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
 
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">if</span> (ii.position != newPos) {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">if</span> (ii.position == mCurItem ) {
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                    <span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">// Our current item changed position. Follow it.</span></pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                    newCurrItem = newPos;
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                }
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
 
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                ii. position = newPos;
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                needPopulate = <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">true</span>;
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            }
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
        }
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
 
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
        <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">if</span> (isUpdating) {
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            mAdapter.finishUpdate( <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">this</span>);
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
        }
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
 
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
        Collections. sort(mItems, COMPARATOR);
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
 
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
        <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">if</span> (needPopulate) {
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            <span style="border:0px none rgb(0, 128, 0);margin:0px;padding:0px;color:rgb(0, 128, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">// Reset our known page widths; populate will recompute them.</span></pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
            final <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">int</span> childCount = getChildCount();
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">for</span> (<span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">int</span> i = 0; i &lt; childCount; i++) {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                final View child = getChildAt(i);
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                final LayoutParams lp = (LayoutParams) child.getLayoutParams();
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">if</span> (!lp.isDecor ) {
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
                    lp. widthFactor = 0.f;
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
                }
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            }
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
 
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
            setCurrentItemInternal(newCurrItem, <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">false</span>, <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">true</span>);
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
            requestLayout();
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
        }
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
    }
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
 
</pre></div><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:28px;">  重点看这样一行代码：</p><div style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0px;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:168px;"><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
 final <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">int</span> newPos = mAdapter.getItemPosition(ii.<span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">object</span> );
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
 
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
   <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">if</span> (newPos == PagerAdapter.POSITION_UNCHANGED ) {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
         <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">continue</span> ;
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
   }
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
 
</pre></div><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:28px;">  官方对getItemPosition()的解释是：</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:84px;">  Called when the host view is attempting to determine if an item’s position has changed. Returns <a href="http://www.67tgb.com/?p=624eclipse-javadoc:%E2%98%82=Youku_TV%2F%5C%2FBaseProject%5C%2Flibs%5C%2Fandroid-support-v4.jar%3Candroid.support.v4.view(PagerAdapter.class%E2%98%83PagerAdapter~getItemPosition~Ljava.lang.Object;%E2%98%82%E2%98%82POSITION_UNCHANGED" style="border:0px none rgb(98, 98, 98);margin:0px;padding:0px;color:rgb(98, 98, 98);text-decoration:none;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">POSITION_UNCHANGED</a> if the position of the given item has not changed or <a href="http://www.67tgb.com/?p=624eclipse-javadoc:%E2%98%82=Youku_TV%2F%5C%2FBaseProject%5C%2Flibs%5C%2Fandroid-support-v4.jar%3Candroid.support.v4.view(PagerAdapter.class%E2%98%83PagerAdapter~getItemPosition~Ljava.lang.Object;%E2%98%82%E2%98%82POSITION_NONE" style="border:0px none rgb(98, 98, 98);margin:0px;padding:0px;color:rgb(98, 98, 98);text-decoration:none;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">POSITION_NONE</a> if the item is no longer present in the adapter.</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:56px;">The default implementation assumes that items will never change position and always returns <a href="http://www.67tgb.com/?p=624eclipse-javadoc:%E2%98%82=Youku_TV%2F%5C%2FBaseProject%5C%2Flibs%5C%2Fandroid-support-v4.jar%3Candroid.support.v4.view(PagerAdapter.class%E2%98%83PagerAdapter~getItemPosition~Ljava.lang.Object;%E2%98%82%E2%98%82POSITION_UNCHANGED" style="border:0px none rgb(98, 98, 98);margin:0px;padding:0px;color:rgb(98, 98, 98);text-decoration:none;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">POSITION_UNCHANGED</a>.</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:84px;">  意思是如果item的位置如果没有发生变化，则返回POSITION_UNCHANGED。如果返回了POSITION_NONE，表示该位置的item已经不存在了。默认的实现是假设item的位置永远不会发生变化，而返回POSITION_UNCHANGED</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:28px;"> </p><h3 style="border:0px none rgb(51, 51, 51);margin:0px;padding:0px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;">解决方案：</h3><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:84px;">  所以我们可以尝试着修改适配器的写法，覆盖getItemPosition()方法，当调用notifyDataSetChanged时，让getItemPosition方法人为的返回POSITION_NONE，从而达到强迫viewpager重绘所有item的目的。</p><p style="border:0px none rgb(51, 51, 51);margin:0px;padding:5px 0px;text-indent:22px;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;height:28px;">  具体代码如下：</p><div style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0px;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:560px;"><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;"><span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">class</span> SearchAdapter extends PagerAdapter {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
    
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
     <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">private</span> <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">int</span> mChildCount = 0;
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
 
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
     @Override
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
     <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">public</span> <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">void</span> notifyDataSetChanged() {         
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
           mChildCount = getCount();
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
           super.notifyDataSetChanged();
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
     }
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
 
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
     @Override
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
     <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">public</span> <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">int</span> getItemPosition(Object <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">object</span>)   {          
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
           <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">if</span> ( mChildCount &gt; 0) {
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
           mChildCount --;
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
           <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">return</span> POSITION_NONE;
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
           }
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
           <span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">return</span> super.getItemPosition(<span style="border:0px none rgb(0, 0, 255);margin:0px;padding:0px;color:rgb(0, 0, 255);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">object</span>);
</pre><pre style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;">
     }
</pre><pre style="font-size:small;border:0px none rgb(0, 0, 0);padding:0px;background-color:rgb(244, 244, 244);width:670px;margin:0em;color:black;font-family:consolas, &quot;Courier New&quot;, courier, monospace;background-image:none;box-shadow:none;height:28px;">
 
</pre><div style="font-family:consolas, &quot;Courier New&quot;, courier, monospace;border:0px none rgb(0, 0, 0);padding:0px;font-size:small;color:black;margin:0em;background-color:rgb(255, 255, 255);background-image:none;box-shadow:none;width:670px;height:28px;"><div>}</div><div><br/></div><div><br/></div><div><br/></div></div></div><p style="border:0px none rgb(51, 51, 51);margin:0;padding:0;text-indent:22px;height:1px;overflow:hidden;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:670px;"><a href="http://www.wumii.com/widget/relatedItems.htm" style="border:0px none rgb(98, 98, 98);margin:0px;padding:0px;color:rgb(98, 98, 98);text-decoration:none;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;"><img src="Viewpager之notifyDataSetChanged无刷新_files/pixel.png" type="image/png" data-filename="pixel.png" alt="无觅相关文章插件，快速提升流量" height="1" style="border: 0px none rgb(98, 98, 98); margin: 0px; padding: 0px; display: block; background-color: rgba(0, 0, 0, 0); background-image: none; box-shadow: none; width: 1px; height: auto;" width="1"/></a></p></div></div></div><div style="-evernote-webclip:true"><br/></div></span>
</div></body></html> 