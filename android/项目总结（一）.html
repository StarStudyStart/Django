<html>
<head>
  <title>项目总结（一）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="814"/>
<h1>项目总结（一）</h1>

<div>
<span><div><span style="font-size: 16px;">前几天想在coolweather项目中使用ToolBar和DrawerLayout结合使用的方式，改变外观界面。。。。然而在eclipse中导入v-7包还好，虽然也是各种坑但总算解决了一大堆问题。然后 还有导入design包，出现一些错误也解决了。但是但是但是 运行出错 。我实在找不到错误的地方，网上一些解决方案都是关于studio的，于是放弃eclipse，将整个项目，转移到Android Studio中，于是一大波问题来了。。。。。。。。。</span></div><div><br/></div><div><span style="color: rgb(227, 0, 0);"><span style="font-size: 15px;">1、 AS中不加权限声明竟然也能运行程序。。。。。而且不会出错！！！一般正常的写代码用到权限的地方AS会自动提示加入权限，但是自己copy过来的就没这样的提示了。。。这个问题纠结了半天。</span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="font-size: 15px;">2、locationManager.getLastKnownLocation(provider)，在手机上测试半天加载不出来location的经纬度信息。。。原来是手机最近恢复出厂设置，原来存储在provider中的位置信息就没了，然后location就为空了。</span></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.148438);"><div>//      Returns a Location indicating the data from the last known location fix obtained from the given provider.</div><div>//      这个方法只是返回 最近已知的位置信息。如果是新的机器  从来没有获取过位置信息；那location为空了</div><div>Location location = locationManager.getLastKnownLocation(provider);</div><div>if (location != null) {</div><div>    queryLocationName(location);</div><div>}</div></div><div><br/></div><div><span style="color: rgb(227, 0, 0);"><span style="font-size: 15px;">3、网络请求的连接如果有中文字符的话，要转码之后才能正常的访问地址。</span></span></div><div style="background-color:#ffffff;color:#000000;font-family:'宋体';font-size:9.6pt;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.148438);"><div>address = &quot;http://wthrcdn.etouch.cn/weather_mini?city=&quot; +<span style="color: rgb(227, 0, 0);"> URLEncoder.encode(cityNmae, &quot;utf-8&quot;)</span>;</div></div><div style="background-color:#ffffff;color:#000000;font-family:'宋体';font-size:9.6pt;"><br/></div><div style="background-color: rgb(255, 255, 255); font-family: 宋体;"><span style="font-size: 16px;"><span style="color: rgb(227, 0, 0);">4、不要乱改stuidio中的包名，最好一开始就确定好名称。不然会很惨，各种R文件的问题</span></span></div><div style="background-color: rgb(255, 255, 255); font-family: 宋体;"><span style="font-size: 16px;"><span style="color: rgb(227, 0, 0);">5、遇到问题，要逐步地分析，一步步缩小问题出现的范围。不要乱想，这样很浪费时间。。。。。。。。。</span></span></div><div style="background-color: rgb(255, 255, 255); font-family: 宋体;"><span style="font-size: 16px;"><span style="color: rgb(227, 0, 0);">     例如 本项目中的fragment的oncreateView（）方法，怎样判断是加载本地的天气信息还是其他城市的天气</span></span></div><div style="background-color: rgb(255, 255, 255); font-family: 宋体;"><span style="font-size: 16px;"><span style="color: rgb(227, 0, 0);">         最后想到了一个方法，</span></span></div><div style="background-color: rgb(255, 255, 255); font-family: 宋体;"><span style="font-size: 16px;"><span style="color: rgb(227, 0, 0);">               在创建Fragment对象时，赋予该对象countyName的值（setter）。</span></span></div><div style="background-color: rgb(255, 255, 255); font-family: 宋体;"><span style="font-size: 16px;"><span style="color: rgb(227, 0, 0);">               在onCreate（）中判断获取countyName得值（getter） 为空的话就加载本地天气信息，不为空就加载countyName的天气信息。</span></span></div><div style="background-color: rgb(255, 255, 255); font-family: 宋体;"><span style="font-size: 16px;"><span style="color: rgb(227, 0, 0);">因为对Fragment的适配器，还有生命周期不是很了解，所以错误很难解决。。。总出现重复的本地天气。。。</span></span></div><div style="background-color: rgb(255, 255, 255); font-family: 宋体;"><span style="color: rgb(227, 0, 0);"><span style="font-size: 15px;">6、不要总是纠结一个问题实在想不通就休息一会，，，，，，不然会越来越乱，越来越乱。。。。。。。。</span></span></div><div style="background-color: rgb(255, 255, 255); font-family: 宋体;"><span style="color: rgb(227, 0, 0);">7、在一个方法的开始弹出加载框，最好使用以下方法</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>/**</div><div> * 顯示進度對話框</div><div> */</div><div>public static ProgressDialog showProgressDialog(ProgressDialog progressDialog,Context context) {</div><div>    //避免重复弹出对话框，而出现异常</div><div>    //弹出对话框的所在方法，可能在进度框关闭之前，被再次调用。</div><div>    if(progressDialog == null) {</div><div>        progressDialog = new ProgressDialog(context);</div><div>        progressDialog.setMessage(&quot;正在加载&quot;);</div><div>        progressDialog.setCanceledOnTouchOutside(false);</div><div>    }</div><div>    progressDialog.show();</div><div>    return progressDialog;</div><div>}</div></div><div><br/></div><div><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>private void queryFromSever(String address, final String type) {</div><div>      <span style="color: rgb(227, 0, 0);">  //开启进度提示</span></div><div>        progressDialog = Utility.showProgressDialog(progressDialog,weatherActivity);</div><div>        HttpUtil.snedHttpRequest(address, new HttpCallBackListener() {</div><div>            @Override</div><div>            public void onFinish(String response) {</div><div>                if (&quot;locationInfo&quot;.equals(type)) {</div><div>                    try {</div><div>                        JSONObject jsonObject = new JSONObject(response);</div><div>                        JSONArray result = jsonObject.getJSONArray(&quot;results&quot;);</div><div>                        if (result.length() &gt; 0) {</div><div>                            JSONObject subObject = result.getJSONObject(0);</div><div>                            JSONArray addressArray = subObject.getJSONArray(&quot;address_components&quot;);</div><div>                            JSONObject addressCity = addressArray.getJSONObject(1);</div><div>                            String countyName = addressCity.getString(&quot;short_name&quot;);</div><div>                            final String countyName_Handle = countyName.substring(0, countyName.length() - 1);</div><div><br/></div><div>                            localName = countyName_Handle;</div><div>                            setCountyName(countyName_Handle);</div><div>//                            FragmentControl.addCityName(countyName_Handle);</div><div><span style="color: rgb(227, 0, 0);">                              //这里会再次弹出进度框，如果不判断的话就会出现两个进度框，然后就报错了。。。</span></div><div><span style="color: rgb(227, 0, 0);">                            queryLocationWeatherInfo(countyName_Handle);</span></div><div>                        }</div><div>                    } catch (JSONException e) {</div><div>                        e.printStackTrace();</div><div>                    }</div><div>                } else if (&quot;local_weather&quot;.equals(type)) {</div><div><br/></div><div>                    Log.d(&quot;tag&quot;,response);</div><div>                    boolean isSave = Utility.handleWeatherInfoResponse(weatherActivity, response);</div><div>                    if (isSave) {</div><div>                        weatherActivity.runOnUiThread(new Runnable() {</div><div>                            @Override</div><div>                            public void run() {</div><div>                                <span style="color: rgb(227, 0, 0);">Utility.closeProgressDialog(progressDialog);</span></div><div>                                showWeather();</div><div>                            }</div><div>                        });</div><div>                    }</div><div>                }</div><div>            }</div><div><br/></div><div>            @Override</div><div>            public void onError(Exception e) {</div><div>                weatherActivity.runOnUiThread(new Runnable() {</div><div>                    @Override</div><div>                    public void run() {</div><div>                        <span style="color: rgb(227, 0, 0);">Utility.closeProgressDialog(progressDialog);</span></div><div>                        Toast.makeText(weatherActivity, &quot;请求失败&quot;, Toast.LENGTH_SHORT).show();</div><div>                    }</div><div>                });</div><div>            }</div><div>        });</div><div>    }</div></div><div><br/></div><div><br/></div><div><span style="font-size: 16px;"><span style="color: rgb(227, 0, 0);">感受：1、 好了就这么多总的来说，还有很多问题要解决。。。。请求失败的处理，不然会很乱</span></span></div><div><span style="font-size: 16px;"><span style="color: rgb(227, 0, 0);">          2、下一步就是解决程序退出后，资源释放掉，再次开启之后，几个viewpager就不见了，又回到了最初的起点。。简单的说：就是程序状态的保存，也就是数据的保存。</span></span></div><div><span style="font-size: 16px;"><span style="color: rgb(227, 0, 0);">          3、不想干这个工作了。。。很强烈！！！！！！</span></span></div><div><br/></div><div><br/></div></span>
</div></body></html> 