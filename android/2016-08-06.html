<html>
<head>
  <title>2016-08-06</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="823"/>
<h1>2016-08-06</h1>

<div>
<span><div><span style="font-size: 15px; color: rgb(227, 0, 0);">总结：</span></div><div><span style="font-size: 15px; color: rgb(227, 0, 0);">          今天主要学习了异步消息的处理机制：最主要的两种分别是Handler和AsyncTask；</span></div><div><span style="font-size: 15px;">1、Handler可以将其他线程的消息发送到主线中处理，主要是用于跨线程的数据传输；</span></div><div><span style="font-size: 15px;">          MessageQueue---&gt;Looper-----&gt;Thread-----&gt;Handler</span></div><div><span style="font-size: 15px;">          threadLocal.set（Object obj）;以当前线程对象为键，以obj为值放入到ThreadLocal对象中；</span></div><div><span style="font-size: 15px;">          ① Looper.prepare(); 初始化looper对象的同时创建消息队列对象，并将其放入ThreadLocal中；</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">//      将looper对象并将其放入ThreadLocal中</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">private static void prepare( boolean quitAllowed) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        if ( sThreadLocal.get() != null) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            throw new RuntimeException( &quot;Only one Looper may be created per thread&quot;);</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        }</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        sThreadLocal.set( new Looper(quitAllowed));</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">    }</span></div><div><br/></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">//  在looper的构造方法中初始化消息队列对象赋值给Looper的成员变量、获取当前线程对象；</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">  private Looper( boolean quitAllowed) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        mQueue = new MessageQueue(quitAllowed);</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        mThread = Thread. currentThread();</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">    }</span></div></div><div><br/></div><div><span style="font-size: 15px;">          ② new Handler（）；</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.148438);"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;"> handler = new  Handler(){</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        @Override</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        public void handleMessage(Message msg) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        switch (msg.arg1) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">case UPDATE_UI:</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">textview.setText(&quot;Nice to meet you!&quot;);</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">break;</span></div><div><br/></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">default:</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">break;</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">}</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        }</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        };</span></div></div><div><br/></div><div><span style="font-size: 15px;">          取出ThreadLocal中放入的looper对象赋值给Handler类中的成员变量mLooper；再将mLooper中的mQueue变量取出复制给当前类的变量；</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">//      实现了MessageQueue、looper、handler的一一对应关系；</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        mLooper = Looper. myLooper();</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        if ( mLooper == null) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            throw new RuntimeException(</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                &quot;Can't create handler inside thread that has not called Looper.prepare()&quot;);</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        }</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        mQueue = mLooper.mQueue;</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        mCallback = callback;</span></div></div><div><span style="font-size: 15px;">          ③ sendMessage() 或者post（Runnable r）；</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">//          将消息加入到队列中，如果是post方法则将该handler对象直接赋值给 Message.target变量；</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">  private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        msg.target = this;</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        if ( mAsynchronous) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            msg.setAsynchronous( true);</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        }</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        return queue.enqueueMessage(msg, uptimeMillis);</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">    }</span></div></div><div><br/></div><div><span style="font-size: 15px;">          ④ Looper.loop();  将Message对象从消息队列中取出，找到该消息对应的handler对象，调用<span style="background-color: rgb(232, 242, 254); background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 15px; font-family: &quot;Courier New&quot;; background-color: rgb(232, 242, 254);">dispatchMessage()方法；</span></span></span></div><div><span style="background-color: rgb(232, 242, 254);"><span style="font-size: 15px; font-family: &quot;Courier New&quot;; background-color: rgb(232, 242, 254);">               调用loop（）方法，如果消息队列中的消息过多可能会发生阻塞。</span></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">public void dispatchMessage(Message msg) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        if (msg.callback != null) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">//          直接调用callbak的message.callback.run();直接在主线程中运行runnable接口中的代码；</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            handleCallback(msg);  </span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        } else {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            if ( mCallback != null ) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                if ( mCallback .handleMessage(msg)) {</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                    return;</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                }</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            }</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            handleMessage(msg); //     调用刚才创建对象时重写地方法</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        }</span></div><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">    }</span></div></div><div><br/></div><div><span style="font-size: 15px; font-family: &quot;Courier New&quot;;">Handler、Looper、MessageQueue三种对象的实例化必须保持在同一线称中，否则会出现程序异常；</span></div><div><span style="font-size: 15px; font-family: &quot;Courier New&quot;;">2、异步任务</span></div><div><span style="font-family: &quot;Courier New&quot;;">     自定义一个类继承AsyncTask&lt;xx1,xx2,xx3&gt;</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">public class DownloadsTask extends AsyncTask&lt;Void, Integer, Boolean&gt; {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      /**</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      * 这三个泛型参数分别表示</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      *</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      * @param Void</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      *            开启后台任务是需要传入的参数</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      * @param Integer</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      *            后台任务执行时 ，调用publishProgress()方法时需要传入的参数；</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      * @param Bolean</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      *            后台任务执行结束时的返回类型；</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      */</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      private ProgressDialog progDialog;</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      private Context context;</span></div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      /**</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      * 传入参数 所需要操作的UI对象 ，环境等等</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      *</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      * @param context</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      */</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      public DownloadsTask(Context context) {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           this. context = context;</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">     }</span></div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      /**</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      * 在主线程中运行可以初始化控件, 在后台任务执行之前调用</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      */</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      @Override</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      protected void onPreExecute() {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           // TODO Auto-generated method stub</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           progDialog = new ProgressDialog( context);</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           progDialog.setTitle( &quot;Downloading&quot; );</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           progDialog.setCancelable( false);</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           progDialog.show();</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">     }</span></div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      /**</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      * 新开一个线程来运行一些耗时较长的逻辑 可以通过publishProgress（ xxx）将得到的结果返回到主线程中</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      */</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      @Override</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      protected Boolean doInBackground(Void... params) {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           // TODO Auto-generated method stub</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           int downPrecent = 0;</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           try {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                while ( true) {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                    downPrecent = downPrecent + 5;</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                    Thread. sleep(500);</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                     /**</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                     * This method can be invoked from doInBackground to publish</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                     * updates on the UI thread while the background computation is</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                     * still running. Each call to this method will trigger the</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                     * execution of onProgressUpdate on the UI thread.</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                     * onProgressUpdate will note be called if the task has been</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                     * canceled.</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                     */</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                    publishProgress(downPrecent);</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                     if (downPrecent &gt;= 100) {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                          break;</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                    }</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">               }</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">          } catch (Exception e) {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                return false;</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">          }</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           return true;</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">     }</span></div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      /**</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      * 主线程中运行 在pulishProgress()调用后接收异步线程中的消息</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      */</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      @Override</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      protected void onProgressUpdate(Integer... values) {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           // TODO Auto-generated method stub</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           for (Integer integer : values) {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                progDialog.setMessage(integer + &quot; %&quot;);</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">          }</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">     }</span></div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      /**</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      * 主线程中运行 后台任务执行完毕之后 接受返回的结果,然后进行一些操作</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      */</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      @Override</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">      protected void onPostExecute(Boolean result) {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           // TODO Auto-generated method stub</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           progDialog.dismiss();</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">           if (result) {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">               Toast. makeText( context, &quot;下载成功&quot;, Toast.LENGTH_SHORT ).show();</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">          } else {</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">               Toast. makeText( context, &quot;下载失败&quot;, Toast.LENGTH_SHORT ).show();</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">          }</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">     }</span></div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">}</span></div></div><div><br/></div><div><span style="font-family: &quot;Courier New&quot;;">  <span style="font-size: 15px; font-family: &quot;Courier New&quot;;"> ② 最后在主线程中实例化 自定义的异步任务类。调.execute()</span></span></div><div><br/></div><div><br/></div><div><span style="font-size: 15px; color: rgb(255, 0, 0); font-family: &quot;Courier New&quot;;">遗留问题:  ① handler流程图</span></div><div><span style="font-size: 15px; color: rgb(255, 0, 0); font-family: &quot;Courier New&quot;;">          ② 使用notification提示用户下载进度</span></div><div><span style="font-size: 15px; font-family: &quot;Courier New&quot;; color: rgb(255, 0, 0);">          ③ 在程序中实例化控件，怎样设置控件的参数；</span></div><div><span style="font-family: &quot;Courier New&quot;; color: rgb(255, 0, 0);">           ④  泛型的理解；</span></div></span>
</div></body></html> 